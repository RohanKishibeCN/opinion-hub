events {}
http {
  server {
    listen 80;
    server_name _;

    gzip on;
    gzip_types text/plain application/json text/css application/javascript;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    location /api/ {
      proxy_pass http://api:4000/api/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

    location = /health {
      return 200;
    }

    location / {
      proxy_pass http://web:3000/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-Proto $scheme;
      add_header Cache-Control "public, max-age=120";
    }
  }

  # HTTPS placeholder (certs volume ready)
  # server {
  #   listen 443 ssl;
  #   server_name _;
  #   ssl_certificate     /etc/ssl/certs/fullchain.pem;
  #   ssl_certificate_key /etc/ssl/certs/privkey.pem;
  #   include /etc/ssl/certs/options-ssl-nginx.conf;
  #   ssl_dhparam /etc/ssl/certs/ssl-dhparams.pem;
  #   location / { proxy_pass http://web:3000/; }
  #   location /api/ { proxy_pass http://api:4000/api/; }
  # }
}
